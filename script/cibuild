#!/usr/bin/env ruby

sha = `git rev-parse HEAD`.chop
key = File.expand_path('../atom.githubapp.com', __FILE__)
system 'chmod', '600', key

system 'ssh',
  '-l', 'github',
  '-i', key,
  '-o', 'StrictHostKeyChecking=no',
  '-p', '6000',
  'atom.githubapp.com',
  "cd /Users/github/code/atom && git fetch -q origin && git reset -q --hard #{sha} && rake test && rake benchmark"

exit $?.exitstatus